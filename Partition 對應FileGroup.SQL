WITH V1 AS(
SELECT ROW_NUMBER() OVER(PARTITION BY S1.NAME ORDER BY S3.VALUE) AS 'RowNumber',
S1.NAME AS PARTITION_SCHEME,S2.NAME AS PARTITION_FUNC,S3.BOUNDARY_ID,S3.VALUE AS DT,S5.NAME AS FG 
FROM SYS.PARTITION_SCHEMES AS S1
JOIN SYS.PARTITION_FUNCTIONS AS S2 ON S1.FUNCTION_ID=S2.FUNCTION_ID
JOIN SYS.PARTITION_RANGE_VALUES AS S3 ON S1.FUNCTION_ID=S3.FUNCTION_ID
JOIN SYS.DESTINATION_DATA_SPACES AS S4 ON S1.DATA_SPACE_ID=S4.PARTITION_SCHEME_ID AND S3.BOUNDARY_ID=S4.DESTINATION_ID
JOIN SYS.DATA_SPACES AS S5 ON S4.DATA_SPACE_ID=S5.DATA_SPACE_ID)
SELECT S1.PARTITION_SCHEME,S1.PARTITION_FUNC,S1.BOUNDARY_ID,ISNULL(S2.DT,'1900-01-01 00:00:00.000') AS BEG_DT,S1.DT AS END_DT,S1.FG FROM V1 AS S1
LEFT JOIN V1 AS S2 ON S1.PARTITION_SCHEME=S2.PARTITION_SCHEME AND S1.ROWNUMBER=S2.ROWNUMBER+1
ORDER BY S1.PARTITION_SCHEME,S1.DT




WITH V1 AS(
SELECT 
ROW_NUMBER() OVER(PARTITION BY S1.NAME ORDER BY ISNULL(S3.VALUE,CONVERT(DATE,'2099-01-01 00:00:00'))) AS 'RowNumber',
S1.NAME AS PARTITION_SCHEME,S2.NAME AS PARTITION_FUNC,S3.BOUNDARY_ID,ISNULL(S3.VALUE,CONVERT(DATE,'2099-01-01 00:00:00')) AS DT,S5.NAME AS FG,S4.DESTINATION_ID 
FROM SYS.PARTITION_SCHEMES AS S1
JOIN SYS.PARTITION_FUNCTIONS AS S2 ON S1.FUNCTION_ID=S2.FUNCTION_ID
left JOIN SYS.DESTINATION_DATA_SPACES AS S4 ON S1.DATA_SPACE_ID=S4.PARTITION_SCHEME_ID 

left jOIN SYS.PARTITION_RANGE_VALUES AS S3 ON S1.FUNCTION_ID=S3.FUNCTION_ID AND S3.BOUNDARY_ID=S4.DESTINATION_ID

JOIN SYS.DATA_SPACES AS S5 ON S4.DATA_SPACE_ID=S5.DATA_SPACE_ID)
SELECT S1.PARTITION_SCHEME,S1.PARTITION_FUNC,S1.BOUNDARY_ID,ISNULL(S2.DT,'1900-01-01 00:00:00.000') AS BEG_DT,S1.DT AS END_DT,S1.FG FROM V1 AS S1
LEFT JOIN V1 AS S2 ON S1.PARTITION_SCHEME=S2.PARTITION_SCHEME AND S1.ROWNUMBER=S2.ROWNUMBER+1
ORDER BY S1.PARTITION_SCHEME,S1.DT